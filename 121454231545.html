<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>prototype</title>
  <link rel="icon" href="9582013.png">


<style>
body{
  margin:0;
  font-family:"Segoe UI",system-ui,sans-serif;
  background:linear-gradient(135deg,#f5f7fa,#c3cfe2);
}

header{
  padding:16px;
  background:#fff;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
}

main{
  padding:24px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:16px;
}

.palette{
  background:#fff;
  border-radius:12px;
  overflow:hidden;
  cursor:pointer;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}

.palette .colors{
  display:flex;
  height:100px;
}

.palette .colors div{
  flex:1;
}

.palette h4{
  margin:0;
  padding:12px;
  font-size:14px;
  text-align:center;
}

.swatch{
  padding:16px;
  color:#000;
  border-radius:8px;
  cursor:pointer;
  text-align:center;
  margin:8px 0;
}

.row{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}

input[type=file]{
  margin-top:8px;
}

  .upload-btn{
  display:inline-block;
  padding:10px 18px;
  border-radius:999px;
  background:linear-gradient(135deg,#111,#444);
  color:#fff;
  font-size:14px;
  cursor:pointer;
  transition:.3s;
  user-select:none;
}

.upload-btn:hover{
  transform:translateY(-1px);
  box-shadow:0 8px 20px rgba(0,0,0,.25);
}

.upload-btn:active{
  transform:translateY(0);
}

</style>
</head>
<body>

<header>
  <h2>ğŸ¨ Color Palette App</h2>
 <label class="upload-btn">
  ä¸Šå‚³åœ–ç‰‡ç”Ÿæˆè‰²ç¥¨
  <input type="file" accept="image/*" onchange="handleUpload(event)" hidden>
</label>

</header>

<main id="app"></main>

<script>
let palettes = [
  { id:"warm_clay", name:"Warm Clay", colors:["#EA825D","#EAA285","#F3D1C2","#FAF6F4"] }
 
];

/* ===== ä¸»é æ¸²æŸ“ ===== */
function renderHome(){
  const app = document.getElementById("app");
  app.innerHTML = `
    <div class="grid">
      ${palettes.map(p=>`
        <div class="palette" onclick="goPalette('${p.id}')">
          <div class="colors">
            ${p.colors.map(c=>`<div style="background:${c}"></div>`).join("")}
          </div>
          <h4>${p.name}</h4>
        </div>
      `).join("")}
    </div>
  `;
}

/* ===== å–®è‰²é é¢ ===== */
function goPalette(id){
  const p = palettes.find(p=>p.id===id);
  document.getElementById("app").innerHTML = `
    <h3>${p.name}</h3>
    ${p.colors.map(c=>`
      <div class="swatch" style="background:${c}" onclick="goColor('${c}')">
        ${c}
      </div>
    `).join("")}
    <button onclick="renderHome()">â† Back</button>
  `;
}

/* ===== ç›¸é—œè‰²é é¢ ===== */
function goColor(hex){
  renderColor(hex);
}

function renderColor(hex){
  document.body.style.background = hex;
  const {r,g,b} = hexToRgb(hex);
  const {h,s,l} = rgbToHsl(r,g,b);

  const related = {
    analogous:[
      hslToHex((h+330)%360,s,l),
      hslToHex((h+30)%360,s,l)
    ],
    complementary:[hslToHex((h+180)%360,s,l)],
    triadic:[
      hslToHex((h+120)%360,s,l),
      hslToHex((h+240)%360,s,l)
    ]
  };

  document.getElementById("app").innerHTML = `
    <h3>${hex}</h3>

    <h4>Related Colors</h4>

    ${Object.entries(related).map(([k,arr])=>`
      <p>${k}</p>
      <div class="row">
        ${arr.map(c=>`
          <div class="swatch" style="background:${c}" onclick="goColor('${c}')">
            ${c}
          </div>
        `).join("")}
      </div>
    `).join("")}

    <button onclick="renderHome()">â† Back</button>
  `;
}

/* ===== åœ–ç‰‡ç”Ÿæˆè‰²ç¥¨ ===== */
function handleUpload(event){
  const file = event.target.files[0];
  const img = new Image();

  img.onload = () => {
    const colors = extractColors(img,5); // å– 5 å€‹ä¸»è¦è‰²
    palettes.push({
      id:"img_"+Date.now(),
      name:"Image Palette",
      colors: colors
    });
    renderHome();
  };

  img.src = URL.createObjectURL(file);
}

/* ===== åœ–ç‰‡ä¸»è‰²æå– ===== */
function extractColors(img, count=5){
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");
  canvas.width = 100;
  canvas.height = 100;
  ctx.drawImage(img,0,0,100,100);
  const data = ctx.getImageData(0,0,100,100).data;

  // æ”¶é›†åƒç´ 
  let pixels = [];
  for(let i=0;i<data.length;i+=4){
    const r=data[i], g=data[i+1], b=data[i+2], a=data[i+3];
    if(a>128) pixels.push({r,g,b});
  }

  if(pixels.length===0) return ["#cccccc"]; // é˜²æ­¢ç©ºåœ–

  // äº®åº¦æ’åº
  pixels.sort((a,b)=>0.2126*a.r+0.7152*a.g+0.0722*a.b - (0.2126*b.r+0.7152*b.g+0.0722*b.b));

  const seg = Math.floor(pixels.length / count);
  let colors = [];
  for(let i=0;i<count;i++){
    const chunk = pixels.slice(i*seg,(i+1)*seg);
    colors.push(avgColor(chunk));
  }

  return colors;
}

function avgColor(arr){
  const len = arr.length;
  const sum = arr.reduce((acc,p)=>({r:acc.r+p.r,g:acc.g+p.g,b:acc.b+p.b}),{r:0,g:0,b:0});
  return rgbToHex(Math.round(sum.r/len), Math.round(sum.g/len), Math.round(sum.b/len));
}

/* ===== Color Utils ===== */
function hexToRgb(hex){
  const v=parseInt(hex.slice(1),16);
  return {r:(v>>16)&255,g:(v>>8)&255,b:v&255};
}

function rgbToHex(r,g,b){
  return "#"+[r,g,b].map(x=>x.toString(16).padStart(2,"0")).join("");
}

function rgbToHsl(r,g,b){
  r/=255; g/=255; b/=255;
  const max=Math.max(r,g,b), min=Math.min(r,g,b);
  let h,s,l=(max+min)/2;
  if(max===min){h=s=0;}
  else{
    const d=max-min;
    s=l>0.5?d/(2-max-min):d/(max+min);
    switch(max){
      case r:h=(g-b)/d+(g<b?6:0);break;
      case g:h=(b-r)/d+2;break;
      case b:h=(r-g)/d+4;break;
    }
    h*=60;
  }
  return {h,s,l};
}

function hslToHex(h,s,l){
  const f=n=>{
    const k=(n+h/30)%12;
    const a=s*Math.min(l,1-l);
    return l-a*Math.max(-1,Math.min(k-3,9-k,1));
  };
  return rgbToHex(
    Math.round(f(0)*255),
    Math.round(f(8)*255),
    Math.round(f(4)*255)
  );
}

renderHome();
</script>

</body>
</html>

