<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>prototype</title>
  <link rel="icon" href="9582013.png">


<style>
body{
  margin:0;
  font-family:"Segoe UI",system-ui,sans-serif;
  background:linear-gradient(135deg,#f5f7fa,#c3cfe2);
}

header{
  padding:16px;
  background:#fff;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
}

main{
  padding:24px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:16px;
}

.palette{
  background:#fff;
  border-radius:12px;
  overflow:hidden;
  cursor:pointer;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}

.palette .colors{
  display:flex;
  height:100px;
}

.palette .colors div{
  flex:1;
}

.palette h4{
  margin:0;
  padding:12px;
  font-size:14px;
  text-align:center;
}

.swatch{
  padding:16px;
  color:#000;
  border-radius:8px;
  cursor:pointer;
  text-align:center;
  margin:8px 0;
}

.row{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}

input[type=file]{
  margin-top:8px;
}

  .upload-btn{
  display:inline-block;
  padding:10px 18px;
  border-radius:999px;
  background:linear-gradient(135deg,#111,#444);
  color:#fff;
  font-size:14px;
  cursor:pointer;
  transition:.3s;
  user-select:none;
}

.upload-btn:hover{
  transform:translateY(-1px);
  box-shadow:0 8px 20px rgba(0,0,0,.25);
}

.upload-btn:active{
  transform:translateY(0);
}

  .back-btn{
  display:inline-flex;
  align-items:center;
  gap:6px;
  margin:20px 0;
  padding:10px 18px;
  border-radius:999px;
  background:linear-gradient(135deg,#111,#444);
  color:#fff;
  font-size:14px;
  font-weight:500;
  cursor:pointer;
  border:none;
  transition:.3s;
}

.back-btn:hover{
  transform:translateY(-1px);
  box-shadow:0 8px 20px rgba(0,0,0,.25);
}

.back-btn:active{
  transform:translateY(0);
}


</style>
</head>
<body>

<header>
  <h2>✧･ﾟ: *✧･ﾟ:*Color Palette*:･ﾟ✧*:･ﾟ✧</h2>
 <label class="upload-btn">
  上傳圖片生成色票
  <input type="file" accept="image/*" onchange="handleUpload(event)" hidden>
</label>

  <div style="margin-top:12px; display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
  <img id="preview" style="height:48px;border-radius:8px;display:none;">
  
  <label style="font-size:13px;">
    色票數量：
    <input type="range" id="kRange" min="3" max="8" value="5">
    <span id="kVal">5</span>
  </label>
</div>


</header>

<main id="app"></main>

<script>
let palettes = [
  { id:"warm_clay", name:"Warm Clay", colors:["#EA825D","#EAA285","#F3D1C2","#FAF6F4"] }

    { id:"ocean_breeze_1", name:"Ocean Breeze", colors:["#1E4F66","#70A9A1","#C9E4CA","#F0F4F8"] },
  { id:"sunset_glow_1", name:"Sunset Glow", colors:["#FF6F61","#FFA77F","#FFD6A5","#FFF3E0"] },
  { id:"lavender_dream_1", name:"Lavender Dream", colors:["#7B5E99","#B39BC8","#E6D8F2","#FAF5FF"] },
  { id:"mint_frost_1", name:"Mint Frost", colors:["#4CB5AE","#A7D7C5","#E0F2F1","#F9FFFC"] },
  { id:"autumn_maple_1", name:"Autumn Maple", colors:["#A63D40","#E07B7B","#F4C7AB","#FFF1E6"] },
  { id:"peach_blush_1", name:"Peach Blush", colors:["#F5A6A1","#FCD5CE","#FFF1E6","#FFF9F5"] },
  { id:"stormy_sky_1", name:"Stormy Sky", colors:["#2E3C54","#6B7B8C","#B0C4D1","#E6EBF2"] },
  { id:"sunny_meadow_1", name:"Sunny Meadow", colors:["#7BB662","#B8D8A7","#E6F4D9","#F9FFF1"] },
  { id:"coral_tide_1", name:"Coral Tide", colors:["#FF7660","#FFB196","#FFE3D0","#FFF7F2"] },
  { id:"twilight_purple_1", name:"Twilight Purple", colors:["#4B3F72","#8C79A0","#C8B8D8","#F4F0F8"] },
  { id:"autumn_rain_1", name:"Autumn Rain", colors:["#486A8A","#B0C4D1","#F5E1D0","#F7BFAF"] },
  { id:"coral_sky_1", name:"Coral Sky", colors:["#FF7F6E","#FFC4A3","#D0E6F1","#A3C1D9"] },
  { id:"twilight_lilac_1", name:"Twilight Lilac", colors:["#6B5B95","#D6C1E1","#FFE3B3","#FFB380"] },
  { id:"mint_peach_1", name:"Mint Peach", colors:["#50B2A2","#A0E3D6","#FFD7B5","#FF9E80"] },
  { id:"sunset_reef_1", name:"Sunset Reef", colors:["#FF6F61","#FFA77F","#80BBD0","#3C7A91"] },
  { id:"lavender_sunset_1", name:"Lavender Sunset", colors:["#8E7CC3","#D3C0EB","#FFD5A5","#FF8C61"] },
  { id:"frosted_tangerine_1", name:"Frosted Tangerine", colors:["#F5B971","#FFD7AA","#A3D2E2","#467599"] },
  { id:"peach_fog_1", name:"Peach Fog", colors:["#F6A5A2","#FFD6C0","#B0D0E8","#557A95"] },
  { id:"cerulean_coral_1", name:"Cerulean Coral", colors:["#3A7CA5","#A1C6EA","#FFD8B1","#FF8C61"] },
  { id:"sage_sunset_1", name:"Sage Sunset", colors:["#7B9E87","#C6DABF","#FFD8A9","#FF9472"] },
  { id:"misty_melon_1", name:"Misty Melon", colors:["#FFA07A","#FFD2B2","#8EC5FC","#5A7D9A"] },
  { id:"indigo_peach_1", name:"Indigo Peach", colors:["#4B3F72","#A592D6","#FFCAA5","#FF8A61"] },
  { id:"aqua_apricot_1", name:"Aqua Apricot", colors:["#50C9CE","#A6E3E9","#FFD3B6","#FF8B6A"] },
  { id:"rose_fjord_1", name:"Rose Fjord", colors:["#C94C4C","#F2B5A0","#7DB7C9","#3E6682"] },
  { id:"lavender_peach_1", name:"Lavender Peach", colors:["#967BB6","#D3C1E5","#FFCAA5","#FF8C61"] },
  { id:"mint_sunset_1", name:"Mint Sunset", colors:["#64C2A6","#A3E0D8","#FFB788","#FF7A5C"] },
  { id:"cobalt_apricot_1", name:"Cobalt Apricot", colors:["#3B5BA3","#91BCE0","#FFD1A5","#FF8C61"] },
  { id:"stormy_peach_1", name:"Stormy Peach", colors:["#556270","#778CA3","#FFB78F","#FF8C61"] },
  { id:"peach_mist_1", name:"Peach Mist", colors:["#FF9E80","#FFD7B5","#80BBD0","#3C7A91"] },
  { id:"tangerine_frost_1", name:"Tangerine Frost", colors:["#FF914D","#FFD6AA","#8EC5FC","#5A7D9A"] },
  { id:"blue_peach_1", name:"Blue Peach", colors:["#3D5C8A","#9DBCD6","#FFD1A5","#FF8C61"] },
  { id:"lavender_mint_1", name:"Lavender Mint", colors:["#8E7CC3","#D3C0EB","#50B2A2","#A0E3D6"] },
  { id:"sunset_mint_1", name:"Sunset Mint", colors:["#FF6F61","#FFA77F","#50B2A2","#A0E3D6"] },
  { id:"peach_fjord_1", name:"Peach Fjord", colors:["#FF8C61","#FFD1A5","#3A7CA5","#A1C6EA"] },
  { id:"coral_mist_1", name:"Coral Mist", colors:["#FF7660","#FFC4A3","#7EB7E4","#CCD9E8"] },
  { id:"sage_coral_1", name:"Sage Coral", colors:["#7B9E87","#C6DABF","#FF7F6E","#FFA77F"] },
  { id:"contrast_blue_orange", name:"Blue Orange", colors:["#1F3C88","#F38C28","#F4F6FA"] },
  { id:"contrast_purple_yellow", name:"Purple Yellow", colors:["#4B2E83","#FFD547","#F7F4FC"] },
  { id:"contrast_teal_coral", name:"Teal Coral", colors:["#00706F","#FF6F61","#F2FAFA"] },
  { id:"contrast_red_black", name:"Red Black", colors:["#9C1C1C","#1F1F1F","#F5F5F5"] },
  { id:"contrast_navy_lime", name:"Navy Lime", colors:["#102B43","#9FE970","#F3F9F1"] },
  { id:"contrast_indigo_gold", name:"Indigo Gold", colors:["#2D1B69","#E6B550","#FBF7EE"] },
  { id:"contrast_forest_pink", name:"Forest Pink", colors:["#124834","#F2A1B4","#F4FAF7"] },
  { id:"contrast_black_cyan", name:"Black Cyan", colors:["#0F172A","#22D3EE","#F0FDFF"] },
  { id:"contrast_burgundy_mint", name:"Burgundy Mint", colors:["#6D1E2D","#7FE0C3","#F3FBF8"] },
  { id:"contrast_royal_orange", name:"Royal Orange", colors:["#2A2F8F","#FF8B00","#F4F5FB"] },
  { id:"contrast_charcoal_yellow", name:"Charcoal Yellow", colors:["#2B2E34","#FFD94E","#FAFAF0"] },
  { id:"contrast_emerald_violet", name:"Emerald Violet", colors:["#0B7B75","#7C3AED","#F4F1FB"] },
  { id:"contrast_cobalt_pink", name:"Cobalt Pink", colors:["#0048AB","#FF5EA3","#F5F3FA"] },
  { id:"contrast_dark_sand", name:"Dark Sand", colors:["#3A3A3A","#D6B98D","#F4F1EC"] }

 
];

/* ===== 主頁渲染 ===== */
function renderHome(){
  const app = document.getElementById("app");
  app.innerHTML = `
    <div class="grid">
      ${palettes.map(p=>`
        <div class="palette" onclick="goPalette('${p.id}')">
          <div class="colors">
            ${p.colors.map(c=>`<div style="background:${c}"></div>`).join("")}
          </div>
          <h4>${p.name}</h4>
        </div>
      `).join("")}
    </div>
  `;
}

/* ===== 單色頁面 ===== */
function goPalette(id){
  const p = palettes.find(p=>p.id===id);
  document.getElementById("app").innerHTML = `
    <h3>${p.name}</h3>
    ${p.colors.map(c=>`
      <div class="swatch" style="background:${c}" onclick="goColor('${c}')">
        ${c}
      </div>
    `).join("")}
   <button class="back-btn" onclick="renderHome()">
  ← Back to Palettes
</button>

  `;
}

/* ===== 相關色頁面 ===== */
function goColor(hex){
  renderColor(hex);
}

function renderColor(hex){
  document.body.style.background = hex;
  const {r,g,b} = hexToRgb(hex);
  const {h,s,l} = rgbToHsl(r,g,b);

  const related = {
    analogous:[
      hslToHex((h+330)%360,s,l),
      hslToHex((h+30)%360,s,l)
    ],
    complementary:[hslToHex((h+180)%360,s,l)],
    triadic:[
      hslToHex((h+120)%360,s,l),
      hslToHex((h+240)%360,s,l)
    ]
  };

  document.getElementById("app").innerHTML = `
    <h3>${hex}</h3>

    <h4>Related Colors</h4>

    ${Object.entries(related).map(([k,arr])=>`
      <p>${k}</p>
      <div class="row">
        ${arr.map(c=>`
          <div class="swatch" style="background:${c}" onclick="goColor('${c}')">
            ${c}
          </div>
        `).join("")}
      </div>
    `).join("")}

<button class="back-btn" onclick="renderHome()">
  ← Back to Palettes
</button>

  `;
}

  function detectMood(hexes){
  let warm=0,cool=0,muted=0;

  hexes.forEach(hex=>{
    const {r,g,b}=hexToRgb(hex);
    const {h,s,l}=rgbToHsl(r,g,b);

    if(s < 0.25) muted++;
    else if(h < 60 || h > 300) warm++;
    else if(h > 180 && h < 300) cool++;
  });

  if(muted > Math.max(warm,cool)) return "Muted";
  return warm >= cool ? "Warm" : "Cool";
}


/* ===== K-Means Color Utils ===== */

// RGB 距離
function colorDistance(a, b){
  return Math.sqrt(
    (a.r - b.r) ** 2 +
    (a.g - b.g) ** 2 +
    (a.b - b.b) ** 2
  );
}

// 隨機挑 k 個初始中心
function initCentroids(pixels, k){
  const shuffled = pixels.sort(() => 0.5 - Math.random());
  return shuffled.slice(0, k);
}

// K-Means 主體
function kMeans(pixels, k = 5, iterations = 8){
  let centroids = initCentroids(pixels, k);

  for(let i = 0; i < iterations; i++){
    const groups = Array.from({length:k}, () => []);

    pixels.forEach(p => {
      let min = Infinity, idx = 0;
      centroids.forEach((c, i) => {
        const d = colorDistance(p, c);
        if(d < min){
          min = d;
          idx = i;
        }
      });
      groups[idx].push(p);
    });

    centroids = groups.map(group => {
      if(group.length === 0) return centroids[Math.floor(Math.random()*k)];
      const avg = group.reduce((a,b)=>({
        r:a.r+b.r, g:a.g+b.g, b:a.b+b.b
      }),{r:0,g:0,b:0});
      return {
        r:Math.round(avg.r/group.length),
        g:Math.round(avg.g/group.length),
        b:Math.round(avg.b/group.length)
      };
    });
  }

  return centroids;
}

// 過濾太接近的顏色
function dedupeColors(colors, threshold = 40){
  const result = [];
  colors.forEach(c=>{
    if(!result.some(r => colorDistance(c,r) < threshold)){
      result.push(c);
    }
  });
  return result;
}

  
/* ===== 圖片生成色票 ===== */
function handleUpload(event){
  const file = event.target.files[0];
  if(!file) return;

  const img = new Image();
  const preview = document.getElementById("preview");

  preview.src = URL.createObjectURL(file);
  preview.style.display = "block";

  img.onload = () => {
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    const size = 120;
    canvas.width = size;
    canvas.height = size;
    ctx.drawImage(img,0,0,size,size);

    const data = ctx.getImageData(0,0,size,size).data;
    const pixels = [];

    for(let i=0;i<data.length;i+=4){
      const r=data[i],g=data[i+1],b=data[i+2],a=data[i+3];
      if(a<200) continue;
      const v=(r+g+b)/3;
      if(v<20||v>235) continue;
      pixels.push({r,g,b});
    }

    const k = Number(document.getElementById("kRange").value);

    let clusters = kMeans(pixels, k+1);
    clusters = dedupeColors(clusters);

    clusters.sort((a,b)=>
      (a.r+a.g+a.b)-(b.r+b.g+b.b)
    );

    
const colors = clusters
  .sort((a,b)=>{
    const ha = rgbToHsl(a.r,a.g,a.b).h;
    const hb = rgbToHsl(b.r,b.g,b.b).h;
    return ha - hb;
  })
  .slice(0,k)
  .map(c=>rgbToHex(c.r,c.g,c.b));


    const mood = detectMood(colors);

    palettes.push({
      id:"img_"+Date.now(),
      name:`Image Palette · ${mood}`,
      colors
    });

    renderHome();
  };

  img.src = preview.src;
}



/* ===== Color Utils ===== */
function hexToRgb(hex){
  const v=parseInt(hex.slice(1),16);
  return {r:(v>>16)&255,g:(v>>8)&255,b:v&255};
}

function rgbToHex(r,g,b){
  return "#"+[r,g,b].map(x=>x.toString(16).padStart(2,"0")).join("");
}

function rgbToHsl(r,g,b){
  r/=255; g/=255; b/=255;
  const max=Math.max(r,g,b), min=Math.min(r,g,b);
  let h,s,l=(max+min)/2;
  if(max===min){h=s=0;}
  else{
    const d=max-min;
    s=l>0.5?d/(2-max-min):d/(max+min);
    switch(max){
      case r:h=(g-b)/d+(g<b?6:0);break;
      case g:h=(b-r)/d+2;break;
      case b:h=(r-g)/d+4;break;
    }
    h*=60;
  }
  return {h,s,l};
}

function hslToHex(h,s,l){
  const f=n=>{
    const k=(n+h/30)%12;
    const a=s*Math.min(l,1-l);
    return l-a*Math.max(-1,Math.min(k-3,9-k,1));
  };
  return rgbToHex(
    Math.round(f(0)*255),
    Math.round(f(8)*255),
    Math.round(f(4)*255)
  );
}

renderHome();

  const kRange = document.getElementById("kRange");
const kVal = document.getElementById("kVal");

kRange.oninput = () => {
  kVal.textContent = kRange.value;
};

</script>

</body>
</html>

